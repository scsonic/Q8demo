<html>
  <head>
    <script src="js/aframe-master.min.js"></script>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/func.js"></script>

    <style>

    div.buttom {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 50px; 
      background-color: rgba(255, 255, 255, 0.5);
      z-index: 1000; 
      text-align: center;
      line-height: 50px; 
    }

    </style>
    <script>

      var gModel = undefined ;
      
      var showSkl = function(){
        var model = $("#my_model")[0] ;
        gModel = model ;

        const required = ['Armature',"EyeLeft", "EyeRight",'Wolf3D_Head','Wolf3D_Teeth'];
        var target3D = [] ;

        required.forEach((r) => {
          // console.log("r=" + r)
          var obj = gModel.object3D.getObjectByName("Wolf3D_Head");
          // console.log(obj);
          target3D.push(obj);
        });

        gModel.Armature = target3D[0];
        gModel.EyeLeft = target3D[1];
        gModel.EyeRight = target3D[2];
        gModel.Wolf3D_Head = target3D[3];
        gModel.Wolf3D_Teeth = target3D[4];
        
        // for (var i = 0; i < lipChars.length; i++) {
        //   console.log(lipChars[i]);
        //   setTimeout(move , 500*(i+1), lipChars[i]);
        // }
      };


      var bindAll = function(){
        $("#btnSpeak").click(function(v){
          var line = $("#inputText").val() ;
          console.log(line) ;
          speak(line);
        });
      };


      $(function(){
          console.log("init") ;
          setTimeout(function(){
            showSkl() ;  // wait for the model load ready!
          },1000);
          bindAll()
      });

    </script>
  </head>
  <body>
    <a-scene>
        <a-assets>
        <a-asset-item id="james" src="./model/james.glb"></a-asset-item>
      </a-assets>


      <a-sky id="mysky" src="img/sky1.jpg"></a-sky>
      <a-entity id="my_model" gltf-model="#james" position="0 0 -0.5"></a-entity>


    </a-scene>

    <div class="buttom" style="">
      <input type=text id="inputText" />
      <input type=submit value="Send" id="btnSpeak" />

      <button id="speechButton">Hold to Talk</button>

    </div>


    <script>

    const speechButton = document.getElementById('speechButton');
    const inputText = document.getElementById('inputText');

      let recognition;

      speechButton.addEventListener('mousedown', startRecognition);
      speechButton.addEventListener('mouseup', stopRecognition);
      speechButton.addEventListener('mouseleave', stopRecognition);

      function startRecognition() {
        console.log("start rec");
        recognition = new window.webkitSpeechRecognition();
        recognition.lang = 'zh-TW'; // 設置語音識別語言，此處為繁體中文
        recognition.interimResults = true; // 允許即時更新識別結果

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          // outputTextarea.value = transcript;
          inputText.value = transcript;

        };

        recognition.onend = function () {
          console.log("onend rec");
          recognition.stop();
        };

        recognition.start();
      }

      function stopRecognition() {
        console.log("stop rec");
        if (recognition) {
          recognition.stop();
        }
      }
    </script>

  </body>
</html>
